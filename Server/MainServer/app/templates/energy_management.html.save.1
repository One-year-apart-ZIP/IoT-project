{% extends "layout.html" %}

{% block title %}Energy Management Data{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center mb-4">Energy Management Data</h1>
    <table class="table table-bordered table-striped text-center">
        <thead class="thead-dark">
            <tr>
                <th>Timestamp</th>
                <th>Temperature[AC/BO]</th>
                <th>Humidity[HU]</th>
                <th>Gas</th>
            </tr>
        </thead>
        <tbody>
            {% for data in energy_data %}
            <tr>
                <td>{{ data.curDate }}</td>
                <td>{{ data.Temp }} [AC: {{ session.get('ac', 'N/A') }}][BO: {{ session.get('bo', 'N/A') }}]</td>
                <td>{{ data.Hum }} [HU: {{ session.get('hu', 'N/A') }}]</td>
                <td>{{ data.Gas }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="device-controls text-center mt-4">
        <button id="aircon-on" class="btn btn-success">air conditioner-on</button>
        <button id="aircon-off" class="btn btn-danger">air conditioner-off</button>
        <button id="boiler-on" class="btn btn-success">bolier-on</button>
        <button id="boiler-off" class="btn btn-danger">bolier-off</button>
        <button id="humidifier-on" class="btn btn-success">humidifier-on</button>
        <button id="humidifier-off" class="btn btn-danger">humidifier-off</button>
    </div>
    <div class="text-center mt-4">
        <a href="{{ url_for('index') }}" class="btn btn-primary">Back to Home</a>
    </div>
</div>

<script>
function sendCommand(command) {
    fetch('/control-device', {
        method: 'POST',
        headers: {
            'content-Type': 'application/x-www-form-urlencoded',
        },
        body: `command=${command}`
    })
    .then(response => response.json())
    .then(data => {
        if(data.status === 'success') {
            alert(`Command ${command} sent successfully.`);
        } else {
            alert('Failed to send command.');
        }
    })
    .catch(error => console.error('Error:', error));
}

document.getElementById('aircon-on').addEventListener('click', () => sendCommand('aircon_on'));
document.getElementById('aircon-off').addEventListener('click', () => sendCommand('aircon_off'));
document.getElementById('boiler-on').addEventListener('click', () => sendCommand('boiler_on'));
document.getElementById('boiler-off').addEventListener('click', () => sendCommand('boiler_off'));
document.getElementById('humidifier-on').addEventListener('click', () => sendCommand('humidifier_on'));
document.getElementById('humidifier-off').addEventListener('click', () => sendCommand('humidifier_off'));
</script>
{% endblock %}

<!--<script>
function fetchLatestData() {
    fetch('/api/latest-energy-data')  
        .then(response => response.json())
        .then(data => {
            const body = document.getElementById('energy-data-body');
            
            body.innerHTML = '';
            
            const row = `<tr>
                <td>${data.curDate}</td>
                <td>${data.Temp} [AC: ${data.ac}, BO: ${data.bo}]</td>
                <td>${data.Hum} [HU: ${data.hu}]</td>
                <td>${data.Gas}</td>
            </tr>`;
            body.innerHTML = row;
        })
        .catch(error => console.error('Error:', error));
}


document.addEventListener('DOMContentLoaded', function() {
    fetchLatestData();
    setInterval(fetchLatestData, 5000);  
});
</script>-->
